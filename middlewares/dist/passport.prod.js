"use strict";var passport=require("passport"),FacebookStrategy=require("passport-facebook").Strategy,User=require("../services/users"),Bluebird=require("bluebird"),LocalStrategy=require("passport-local").Strategy;passport.use(new LocalStrategy({usernameField:"email",passwordField:"password"},function(e,r,a){User.findOne({where:{email:e}}).then(function(e){return console.log("Username: "+e),!(!e||!User.verifyPassword(r,e.password))&&e}).asCallback(a)})),passport.use(new FacebookStrategy({clientID:process.env.FACEBOOK_APP_ID||"2752121475067022",clientSecret:process.env.FACEBOOK_APP_SECRET||"8c2e31f920cdfdfbea2028dfb5c183c5",callbackURL:process.env.FACEBOOK_CALL_BACK||"http://localhost:3000/auth/facebook/callback",profileFields:["id","emails","displayName"]},function(s,e,t,r){User.findOne({where:{email:t.emails[0].value,facebookId:t.id}}).then(function(r){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r)return r.facebookAccessToken=s,e.abrupt("return",r);e.next=3;break;case 3:return e.next=5,regeneratorRuntime.awrap(User.create({email:t.emails[0].value,displayName:t.displayName,facebookId:t.id,facebookAccessToken:s}));case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}})}).asCallback(r)})),passport.serializeUser(function(e,r){r(null,e.id)}),passport.deserializeUser(function(e,r){User.findByPk(e).asCallback(r)}),module.exports=passport;