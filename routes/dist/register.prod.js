"use strict";var _require=require("express"),Router=_require.Router,asyncHandler=require("express-async-handler"),_require2=require("express-validator"),body=_require2.body,validationResult=_require2.validationResult,crypto=require("crypto"),Email=require("../services/email"),User=require("../services/users"),router=new Router;router.get("/",function(e,r){r.render("register")}),router.post("/",[body("email").isEmail().normalizeEmail(),body("displayName").trim().notEmpty(),body("password").isLength({min:6})],asyncHandler(function(r,a){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=validationResult(r),console.log(t),t.isEmpty()){e.next=4;break}return e.abrupt("return",a.status(422).render("register",{error:t.array()}));case 4:return e.next=6,regeneratorRuntime.awrap(User.create({email:r.body.email,displayName:r.body.displayName,password:User.hashPassword(r.body.password),tooken:crypto.randomBytes(3).toString("hex").toUpperCase()}));case 6:return s=e.sent,e.next=9,regeneratorRuntime.awrap(Email.send(s.email,"Ma Kich Hoat Tai Khoan","".concat(process.env.BASE_URL,"/login/").concat(s.id,"/").concat(s.tooken)));case 9:a.redirect("/");case 10:case"end":return e.stop()}})})),module.exports=router;