"use strict";var _require=require("express"),Router=_require.Router,asyncHandler=require("express-async-handler"),router=new Router,User=require("../services/users");router.get("/",function(e,r){r.render("login")}),router.post("/",asyncHandler(function(r,n){var s,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.findUserByEmail(r.body.email));case 2:if(s=e.sent,t=User.verifyPassword(r.body.password,s.password),s&&t){e.next=6;break}return e.abrupt("return",n.render("login"));case 6:r.session.userId=s.id,n.redirect("/");case 8:case"end":return e.stop()}})})),router.get("/:id/:tooken",asyncHandler(function(r,n){var s,t,o,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.params,t=s.id,o=s.tooken,e.next=3,regeneratorRuntime.awrap(User.findUserById(t));case 3:(a=e.sent)&&a.tooken===o&&(a.tooken,a.save(),r.session.userId=a.id),n.redirect("/");case 6:case"end":return e.stop()}})})),module.exports=router;